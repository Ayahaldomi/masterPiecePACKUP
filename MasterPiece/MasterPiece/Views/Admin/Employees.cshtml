@model IEnumerable<MasterPiece.Models.Lab_Tech>

@{
    ViewBag.Title = "Employees";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}

<style>
    .container {
        margin-top: 50px;
    }

    .table-container {
        margin-top: 20px;
    }

    .card {
        padding: 1em;
        overflow-x: auto;
    }

    button.btn.btn-success {
        margin: 0.5em;
    }

    body {
        background-color: #69acc759;
    }

    .container-fluid {
        padding-top: 120px !important;
    }
</style>

<div class="container mt-5">
    <div class="card shadow p-4 mb-5 bg-white rounded">
        <h2 class="text-center">Employees</h2>
        <p class="text-start">
            <!-- Button to trigger Create New Employee modal -->
            <button type="button" class="btn btn-outline-primary mb-3" data-bs-toggle="modal" data-bs-target="#createEmployeeModal">
                Create New
            </button>
        </p>

        <div class="table-responsive">
            <table class="table table-striped table-bordered">
                <thead class="thead-dark">
                    <tr>
                        <th>@Html.DisplayNameFor(model => model.Name)</th>
                        <th>@Html.DisplayNameFor(model => model.Email)</th>
                        <th>@Html.DisplayNameFor(model => model.Password)</th>
                        <th>@Html.DisplayNameFor(model => model.Status)</th>
                        <th class="text-center">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>@Html.DisplayFor(modelItem => item.Name)</td>
                            <td>@Html.DisplayFor(modelItem => item.Email)</td>
                            <td>@Html.DisplayFor(modelItem => item.Password)</td>
                            <td>@Html.DisplayFor(modelItem => item.Status)</td>
                            <td class="text-center">
                                <!-- Edit button to open edit modal with pre-filled employee data -->
                                <button type="button" class="btn btn-sm btn-outline-warning me-2" data-bs-toggle="modal" data-bs-target="#editEmployeeModal"
                                        onclick="openEditModal('@item.Tech_ID', '@item.Name', '@item.Email', '@item.Password', '@item.Status')">
                                    Edit
                                </button>

                                <!-- Delete button to open delete confirmation modal -->
                                <button type="button" class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteEmployeeModal"
                                        onclick="setDeleteEmployee('@item.Tech_ID', '@item.Name')">
                                    Delete
                                </button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Create Employee Modal -->
<div class="modal fade" id="createEmployeeModal" tabindex="-1" aria-labelledby="createEmployeeModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createEmployeeModalLabel">Create New Employee</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Create Employee Form -->
                @using (Html.BeginForm("CreateEmployee", "Admin", FormMethod.Post))
                {
                    @Html.AntiForgeryToken()
                    <div class="mb-3">
                        <label for="Name" class="form-label">Full Name</label>
                        <input type="text" class="form-control" id="Name" name="Name" required />
                    </div>
                    <div class="mb-3">
                        <label for="Email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="Email" name="Email" required />
                    </div>
                    <div class="mb-3">
                        <label for="Password" class="form-label">Password</label>
                        <input type="password" class="form-control" id="Password" name="Password" required />
                    </div>
                    <div class="mb-3">
                        <label for="Status" class="form-label">Status</label>
                        <select class="form-select" id="Status" name="Status" required>
                            <option value="Super Admin">Super Admin</option>
                            <option value="Admin">Admin</option>
                            <option value="Doctor">Doctor</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">Save</button>
                }
            </div>
        </div>
    </div>
</div>

<!-- Edit Employee Modal -->
<div class="modal fade" id="editEmployeeModal" tabindex="-1" aria-labelledby="editEmployeeModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editEmployeeModalLabel">Edit Employee</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Edit Employee Form -->
                @using (Html.BeginForm("EditEmployee", "Admin", FormMethod.Post))
                {
                    @Html.AntiForgeryToken()
                    @Html.Hidden("Tech_ID", "", new { id = "edit_Tech_ID" })
                    <div class="mb-3">
                        <label for="edit_Name" class="form-label">Full Name</label>
                        <input type="text" class="form-control" id="edit_Name" name="Name" required />
                    </div>
                    <div class="mb-3">
                        <label for="edit_Email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="edit_Email" name="Email" required />
                    </div>
                    <div class="mb-3">
                        <label for="edit_Password" class="form-label">Password</label>
                        <input type="password" class="form-control" id="edit_Password" name="Password" required />
                    </div>
                    <div class="mb-3">
                        <label for="edit_Status" class="form-label">Status</label>
                        <select class="form-select" id="edit_Status" name="Status" required>
                            <option value="Super Admin">Super Admin</option>
                            <option value="Admin">Admin</option>
                            <option value="Doctor">Doctor</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                }
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteEmployeeModal" tabindex="-1" aria-labelledby="deleteEmployeeModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteEmployeeModalLabel">Delete Employee</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete <strong id="deleteEmployeeName"></strong>?</p>
            </div>
            <div class="modal-footer">
                @using (Html.BeginForm("DeleteEmployee", "Admin", FormMethod.Post))
                {
                    @Html.Hidden("Tech_ID", "", new { id = "delete_Tech_ID" })
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-danger">Delete</button>
                }
            </div>
        </div>
    </div>
</div>

<script>
    // Populate Edit Modal with employee data
    function openEditModal(id, name, email, password, status) {
        document.getElementById('edit_Tech_ID').value = id;
        document.getElementById('edit_Name').value = name;
        document.getElementById('edit_Email').value = email;
        document.getElementById('edit_Password').value = password;
        document.getElementById('edit_Status').value = status;
    }

    // Set the employee details for the Delete Confirmation Modal
    function setDeleteEmployee(id, name) {
        document.getElementById('delete_Tech_ID').value = id;
        document.getElementById('deleteEmployeeName').innerText = name;
    }

</script>
